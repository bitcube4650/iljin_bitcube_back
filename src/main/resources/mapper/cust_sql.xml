<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cust">
	<select id="selectDupUserCnt" resultType="int">
		/* item.selectItemGrpList */
		SELECT	(
				SELECT	COUNT(1)
				FROM	T_CO_USER
				WHERE USER_ID = #{userId}
				)
				+
				(
				SELECT	COUNT(1)
				FROM	T_CO_CUST_USER
				WHERE	USER_ID = #{userId}
				)
	</select>
	
	<select id="selectTCoCustList_count" resultType="int">
		/* cust.selectTCoCustList_count */
		SELECT COUNT(1)
		<include refid="selectCustListSql" />
	</select>
	
	<select id="selectTCoCustList" resultType="camel">
		/* cust.selectTCoCustList */ 
		SELECT	A.CUST_CODE
		,		A.CUST_NAME
		,		(SELECT ITEM_NAME FROM T_CO_ITEM X WHERE X.ITEM_CODE = A.CUST_TYPE1)	AS CUST_TYPE1
		,		A.REGNUM
		,		A.PRES_NAME
		,		(SELECT USER_NAME FROM T_CO_CUST_USER X WHERE X.CUST_CODE = A.CUST_CODE AND X.USER_TYPE = '1' LIMIT 1)	AS USER_NAME
		,		DATE_FORMAT(A.CREATE_DATE, '%Y-%m-%d %H:%i')							AS CREATE_DATE
		<include refid="selectCustListSql" />
		ORDER BY A.CREATE_DATE DESC
		<if test="pageSize != null and pageSize != ''">
		LIMIT ${offset}, ${pageSize}
		</if>
	</select>
	
	<sql id="selectCustListSql">
		FROM T_CO_CUST_MASTER A
		INNER JOIN T_CO_CUST_IR B
			ON A.CUST_CODE = B.CUST_CODE
		WHERE	1=1
		<if test="interrelatedCustCode != null and interrelatedCustCode != ''">
		AND		B.INTERRELATED_CUST_CODE = #{interrelatedCustCode}
		</if>
		<choose>
		<when test="certYn != null and certYn != ''">
		AND		A.CERT_YN = #{certYn}</when>
		<otherwise>
		AND		A.CERT_YN IN ('Y', 'D')
		</otherwise>
		</choose>
		<if test="custName != null and custName != ''">
		AND		A.CUST_NAME LIKE CONCAT('%', #{custName}, '%')
		</if>
		<if test="custTypeCode1 != null and custTypeCode1 != ''">
		AND		A.CUST_TYPE1 = #{custTypeCode1}
		</if>
	</sql>
	
	<select id="selectTCoCustDetail" resultType="camel">
		/* cust.selectTCoCustDetail */
		SELECT	A.CUST_CODE
		,		A.CUST_NAME
		,		(SELECT INTERRELATED_NM FROM T_CO_INTERRELATED X WHERE X.INTERRELATED_CUST_CODE = A.INTERRELATED_CUST_CODE)	AS INTERRELATED_NM
		,		CUST_TYPE1
		,		CUST_TYPE2
		,		C.ITEM_NAME				AS CUST_TYPE_NM1
		,		C2.ITEM_NAME			AS CUST_TYPE_NM2
		,		A.REGNUM
		,		A.PRES_NAME
		,		A.PRES_JUMIN_NO
		,		A.CAPITAL
		,		A.FOUND_YEAR
		,		A.TEL
		,		A.FAX
		,		A.ZIPCODE
		,		A.ADDR
		,		A.ADDR_DETAIL
		,		A.REGNUM_FILE
		,		A.REGNUM_PATH
		,		A.B_FILE
		,		A.B_FILE_PATH
		,		A.CERT_YN
		,		A.ETC
		,		B.USER_NAME
		,		B.USER_EMAIL
		,		B.USER_ID
		,		B.USER_HP
		,		B.USER_TEL
		,		B.USER_BUSEO
		,		B.USER_POSITION
		FROM T_CO_CUST_MASTER A
		LEFT OUTER JOIN (
			SELECT	CUST_CODE
			,		USER_ID
			,		USER_NAME
			,		USER_TEL
			,		USER_HP
			,		USER_EMAIL
			,		USER_BUSEO
			,		USER_POSITION
			FROM T_CO_CUST_USER
			WHERE CUST_CODE = #{custCode}
			AND USER_TYPE = '1'
			<!-- AND USE_YN = 'Y' -->
			LIMIT 1
		) B
			ON A.CUST_CODE = B.CUST_CODE
		LEFT OUTER JOIN T_CO_ITEM C
			ON A.CUST_TYPE1 = C.ITEM_CODE
		LEFT OUTER JOIN T_CO_ITEM C2
			ON A.CUST_TYPE2 = C2.ITEM_CODE
		WHERE A.CUST_CODE = #{custCode}
	</select>
	
	<update id="updateTCoCustMasterCert">
		/* cust.updateTCoCustMasterCert */
		UPDATE T_CO_CUST_MASTER
		SET		CERT_YN = #{certYn}
		,		ETC = #{etc}
		,		UPDATE_USER = #{userId}
		,		UPDATE_DATE = NOW()
		WHERE CUST_CODE = #{custCode}
	</update>
	
	<delete id="deleteTCoCustMaster">
		/* cust.deleteTCoCustMaster */
		DELETE FROM T_CO_CUST_MASTER
		WHERE CUST_CODE = #{custCode}
	</delete>
	
	<delete id="deleteTCoCustIr">
		/* cust.deleteTCoCustIr */
		DELETE FROM T_CO_CUST_IR
		WHERE CUST_CODE = #{custCode}
	</delete>
	
	<delete id="deleteTCoCustUser">
		/* cust.deleteTCoCustUser */
		DELETE FROM T_CO_CUST_USER
		WHERE CUST_CODE = #{custCode}
	</delete>
	
	<insert id="insertTCoCustHistory">
		/* cust.insertTCoCustHistory */
		INSERT INTO T_CO_CUST_MASTER_HIST (
				CUST_CODE
		,		CUST_TYPE1
		,		CUST_TYPE2
		,		CUST_NAME
		,		REGNUM
		,		PRES_NAME
		,		PRES_JUMIN_NO
		,		TEL
		,		FAX
		,		ZIPCODE
		,		ADDR
		,		ADDR_DETAIL
		,		CAPITAL
		,		FOUND_YEAR
		,		CERT_YN
		,		ETC
		,		CREATE_USER
		,		CREATE_DATE
		,		UPDATE_USER
		,		UPDATE_DATE
		,		INTERRELATED_CUST_CODE
		,		B_FILE
		,		B_FILE_PATH
		,		REGNUM_FILE
		,		REGNUM_PATH
		)
		SELECT	CUST_CODE
		,		CUST_TYPE1
		,		CUST_TYPE2
		,		CUST_NAME
		,		REGNUM
		,		PRES_NAME
		,		PRES_JUMIN_NO
		,		TEL
		,		FAX
		,		ZIPCODE
		,		ADDR
		,		ADDR_DETAIL
		,		CAPITAL
		,		FOUND_YEAR
		,		CERT_YN
		,		ETC
		,		CREATE_USER
		,		CREATE_DATE
		,		UPDATE_USER
		,		UPDATE_DATE
		,		INTERRELATED_CUST_CODE
		,		B_FILE
		,		B_FILE_PATH
		,		REGNUM_FILE
		,		REGNUM_PATH
		FROM T_CO_CUST_MASTER
		WHERE CUST_CODE = #{custCode}
	</insert>
</mapper>